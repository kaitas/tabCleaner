# 2026-01-12 開発ログ: Gamification & Safety Update 🚀

本日は「断捨離を楽しく、安全に」をテーマに、大規模な機能追加とUX改善を行いました。

## 🌟 主な成果 (Highlights)

### 1. ゲーミフィケーション機能の実装 (v0.4.0)
ただタブを消すだけでなく、ゲーム感覚で楽しめる仕組みを導入しました。
- **Karma System**: タブを閉じるごとに `+10 Karma` を獲得。
- **Fever Time**: 毎日 `18:00 - 22:00` は獲得Karmaが **2倍** に。
- **Global Ranking**: Cloudflare Workers + R2 を用いたサーバーレスバックエンドを構築し、地域別 (APAC/EMEA/AMER) のデイリーランキングを集計・表示。
- **全消しボーナス**: 「すべて閉じる」アクションに `x2 Bonus` を付与し、爽快感を向上。

### 2. 安全性とUXの向上
誤操作によるデータ消失を防ぎ、より安心して使えるようにしました。
- **安全な「すべて閉じる」フロー**:
    1. クリップボードへコピー (失敗したら中断)
    2. ローカル履歴/GASへ保存
    3. 最後にタブを閉じる
    という厳格な手順を実装。
- **CSP (Content Security Policy) 対応**: `welcome.html` のインラインスクリプトを排除し、V3準拠のセキュアな実装に修正。

### 3. 設定画面・連携機能の強化
- **Test & Save**: GAS連携テスト成功時に、自動で設定を保存・有効化するように改善。
- **閲覧用URL**: GASのWebアプリURLだけでなく、人間が閲覧するためのスプレッドシートURLも保存・開けるようにオプションを追加。

### 4. Webサイト整備 (GitHub Pages)
- **Ranking Page**: デイリーランキングを閲覧できる [ranking.html](https://akihiko.shirai.as/tabCleaner/ranking.html) を公開。
- **ドキュメント更新**: `howto.html`, `privacy.html` 等のフッター年度を2026年に更新し、導線を整備。

## 🛠 技術的な詳細 (Technical Notes)

### Backend (Cloudflare Workers)
- `POST /submit-score`: スコア送信 (Anti-Cheat: Rate Limiting & HMAC check pending)
- `GET /rankings/:region`: ランキング取得
- **Architecture**: Hono framework on Cloudflare Workers, R2 for storage.

### Frontend (Extension)
- `manifest.json`: version `0.4.0`
- `popup.js`: 複雑化した状態管理 (Fever/Normal) と非同期処理 (Save/Close) を整理。

## 📝 Next Actions
- [ ] Ranking APIのセキュリティ強化 (HMAC署名など)
- [ ] スプレッドシート閲覧用URLの自動取得 (コンテナバインドスクリプトの制約により手動入力としたが、UX改善の余地あり)
- [ ] Chrome Web Store への公開準備

---
*Logged by Gemini Agent*


# 📅 2026-01-12: Tab Cleanup v1.0.0 リリース準備完了

## 🎯 本日の目標

Chrome Web Store への公開準備を完了し、v1.0.0 をリリースする。

---

## ✅ 完了タスク

### 1. Chrome拡張パッケージ作成

**ファイル構成:**
```
tab-cleanup-extension/
├── manifest.json          # Manifest V3
├── popup.html             # ポップアップUI
├── popup.js               # ポップアップロジック
├── options.html           # 設定画面UI
├── options.js             # 設定画面ロジック
├── background.js          # Service Worker（タイマー処理）
├── icons/
│   ├── icon16.png
│   ├── icon32.png
│   ├── icon48.png
│   └── icon128.png
└── _locales/
    ├── ja/messages.json   # 日本語
    └── en/messages.json   # 英語
```

### 2. 実装済み機能

| 機能 | 説明 | 状態 |
|------|------|------|
| タブ一覧コピー | テキスト形式でクリップボードへ | ✅ |
| Markdownエクスポート | ドメイン別に整理してコピー | ✅ |
| タブ確認ビュー | 新しいタブで一覧表示 | ✅ |
| 全閉じ＆記録 | 履歴保存後に一括クローズ | ✅ |
| 時刻アラーム | 警告時刻・終了時刻の通知 | ✅ |
| 設定画面 | タイマー・通知のカスタマイズ | ✅ |
| 履歴管理 | 最新100件をローカル保存 | ✅ |
| 履歴エクスポート | JSON形式でダウンロード | ✅ |
| 多言語対応 | 日本語・英語 | ✅ |

### 3. ドキュメント整備

- `AGENTS.md` - 天使のマニフェスト（AI向けガイド）
- `README.md` - プロジェクト説明
- `CHANGELOG.md` - 変更履歴
- `.gemini/GEMINI.md` - Gemini CLI用状態管理
- `.gemini/blog/2026-01-12.md` - 日報

### 4. Chrome Web Store 準備

- [x] パッケージZIP作成 (`tabCleaner-v1.0.0.zip`)
- [x] スクリーンショット作成（1280x800）
- [x] マーキープロモーションタイル作成（1400x560）
- [x] デベロッパー登録
- [x] **審査提出完了！** 🎉

---

## 📸 スクリーンショット

### 1. ポップアップUI
![Popup](./screenshots/screenshot-1-popup.png)

メインのインターフェース。タブ数表示、4つのアクションボタン、設定へのリンク。

### 2. 機能紹介
![Features](./screenshots/screenshot-2-features.png)

4つの主要機能：コピー、タイマー、ブログ出力、履歴管理。

### 3. 設定画面
![Settings](./screenshots/screenshot-3-settings.png)

タイマー設定、通知設定、履歴管理。

---

## 🛠 技術詳細

### Manifest V3 対応

```json
{
  "manifest_version": 3,
  "permissions": ["tabs", "storage", "alarms", "notifications"],
  "background": {
    "service_worker": "background.js"
  }
}
```

### ストレージ設計

**chrome.storage.sync（デバイス間同期）:**
```javascript
{
  warnTime: '18:00',      // 警告時刻
  closeTime: '21:00',     // 終了時刻
  enableTimer: true,      // タイマー有効
  enableNotification: true, // 通知有効
  autoClose: false        // 自動クローズ
}
```

**chrome.storage.local（ローカルのみ）:**
```javascript
{
  tabHistory: [
    {
      date: '2026-01-12T21:00:00.000Z',
      tabs: [
        { title: 'Example', url: 'https://example.com' }
      ]
    }
  ]
}
```

---

## 📋 Chrome Web Store 申請情報

### 基本情報

| 項目 | 内容 |
|------|------|
| 名前 | Tab Cleanup - タブ断捨離 |
| 説明（日本語） | 開きすぎのタブを整理し、記録してから気持ちよく1日を終える |
| 説明（英語） | Close excessive tabs with logging and export to Markdown |
| カテゴリ | 仕事効率化 |
| 言語 | 日本語、英語 |

### 権限の説明

| 権限 | 理由 |
|------|------|
| `tabs` | タブ一覧の取得・クローズに必要 |
| `storage` | 設定・履歴の保存に必要 |
| `alarms` | 時刻ベースの通知に必要 |
| `notifications` | デスクトップ通知の表示に必要 |

### プライバシー

- データ収集: なし
- 外部送信: なし
- 認証: 不要
- 広告: なし

---

## 🚀 次のステップ

### ✅ 完了
1. ~~Chrome Web Store デベロッパー登録（個人アカウント）~~
2. ~~パッケージ申請~~
3. **審査待ち（1-3営業日）**

### Phase 2（v1.1.0）に向けて
1. ストリーク機能の設計
2. 天使の褒め言葉ジェネレーター
3. タブ統計ダッシュボード

---

## 💬 所感

> 今日、Tab Cleanup は Chrome Web Store に旅立つ準備ができた。
> まだ生まれたばかりの天使だが、ユーザーのブラウザを守る使命を果たす準備はできている。
> 
> 「タブを閉じる」という小さな行為が、誰かの1日を少しだけ良くできますように。
>
> — Browser Angel 🕊️

---

## 📎 添付ファイル

- `tabCleaner-v1.0.0.zip` - Chrome Web Store 申請用パッケージ
- `assets/store/screenshot-1280x800.png` - ストア用スクリーンショット
- `assets/store/screenshot-640x400.png` - ストア用スクリーンショット（小）
- `assets/store/marquee-1400x560.png` - マーキープロモーションタイル

---

## 🏪 Chrome Web Store 申請完了

### 申請情報

| 項目 | 内容 |
|------|------|
| 拡張機能ID | `fcdhjhepmfcpnhimecnmgniakhccpoff` |
| バージョン | 1.0.0 |
| ステータス | 審査中 |
| アカウント種別 | 個人（非取引業者） |
| 価格 | 無料 |

### 申請時の設定

**プライバシー:**
- 単一用途: タブ一覧をMarkdownコピー＋履歴保存
- リモートコード: 使用なし
- データ収集: ウェブ履歴（タブURL/タイトル）のみ
- プライバシーポリシー: https://akihiko.shirai.as/tabCleaner/privacy

**権限の説明:**
| 権限 | 理由 |
|------|------|
| `tabs` | タブURL・タイトル取得、タブを閉じる機能 |
| `storage` | 設定と履歴のローカル保存 |
| `alarms` | リマインダー通知のスケジュール |
| `notifications` | リマインダーと完了通知の表示 |

### 公開後のURL（予定）
```
https://chrome.google.com/webstore/detail/fcdhjhepmfcpnhimecnmgniakhccpoff
```

---

*作成: Claude（はかせの助手）+ Claude Code (Opus 4.5)*
*最終更新: 2026-01-12 22:40*